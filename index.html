<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Facebook Post Stats</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  h1 { color: #4267B2; }
  .post { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; border-radius: 5px; }
  .stat { margin: 5px 0; }
</style>
</head>
<body>

<h1>Facebook Post Stats</h1>

<div id="posts"></div>

<script>
const posts = {
  "Fyang": "ZmVlZGJhY2s6MTIyMjQwNjQ1NDMyMDc0NjE5",
  "Maloi": "ZmVlZGJhY2s6MTIyMjQwNjQ0NzI0MDc0NjE5",
  "Stell": "ZmVlZGJhY2s6MTIyMjQwNjQ0NzcyMDc0NjE5"
};

// Session tokens (replace with yours)
const fb_dtsg = "NAftSGxIH9AA8B7cF4KEPlkV91fVtVk8BBF6PCwammW74JUDqwbQUFw:16:1756974490";
const lsd = "R6U-Xyv2MmVrp9n2toO85y";
const jazoest = "25547";

const headers = {
  "accept": "*/*",
  "content-type": "application/x-www-form-urlencoded",
  "x-asbd-id": "359341",
  "x-fb-lsd": lsd
};

async function fetchGraphQL(doc_id, variables, friendlyName) {
  const body = new URLSearchParams({
    fb_dtsg,
    jazoest,
    fb_api_caller_class: "RelayModern",
    fb_api_req_friendly_name: friendlyName,
    variables: JSON.stringify(variables),
    doc_id,
    server_timestamps: "true"
  });

  const res = await fetch("https://www.facebook.com/api/graphql/", {
    method: "POST",
    headers,
    body,
    credentials: "include"
  });

  const text = await res.text();
  try {
    return JSON.parse(text);
  } catch {
    console.error(`❌ Failed to parse ${friendlyName}`, text.slice(0, 300));
    return null;
  }
}

async function updatePosts() {
  const container = document.getElementById("posts");
  container.innerHTML = "";

  for (const [name, postId] of Object.entries(posts)) {
    const reactionsData = await fetchGraphQL("24051433444544934", { feedbackTargetID: postId, scale: 1 }, "CometUFIReactionsDialogQuery");
    const reactionsSummary = reactionsData?.data?.node?.top_reactions?.summary || [];
    const totalReactions = reactionsSummary.reduce((sum, r) => sum + (r.reaction_count || 0), 0);

    const commentsData = await fetchGraphQL("23985348781089875", { feedbackTargetID: postId }, "CometUFICommentsCountTooltipContentQuery");
    const totalComments = commentsData?.data?.feedback?.comment_rendering_instance?.comments?.total_count || 0;

    const sharesData = await fetchGraphQL("9843821265734688", { feedbackTargetID: postId }, "CometUFISharesCountTooltipContentQuery");
    const totalShares = sharesData?.data?.feedback?.reshares?.count || 0;

    container.innerHTML += `
      <div class="post">
        <h2>${name}</h2>
        <div class="stat">Reactions: ${totalReactions}</div>
        <div class="stat">Comments: ${totalComments}</div>
        <div class="stat">Shares: ${totalShares}</div>
      </div>
    `;
  }
}

// Initial load
updatePosts();

// Update every 1 minute
setInterval(updatePosts, 60 * 1000);
</script>

</body>
</html>
